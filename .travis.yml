dist: focal
language: ruby
cache: bundler

rvm:
  - 2.6
  - 2.7
  - 3.0

env:
  global:
    - BUNDLE_JOBS=4

services:
  - postgresql

before_install:
  - gem update --system --force -N > /dev/null && echo "Rubygems version $(gem --version)"
  - gem install bundler --force -N && bundle --version

install:
  - bundle install

before_script:
  - bundle exec rake pm:test:prepare

script:
  - bundle exec rubocop
  - bundle exec rspec

deploy:
  edge: true # opt in to dpl v2
  gem: policy_machine
  provider: rubygems
  on:
    tags: true
    condition: $TRAVIS_RUBY_VERSION == 3.0
